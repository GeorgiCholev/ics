{"ast":null,"code":"import { HttpHeaders } from \"@angular/common/http\";\nimport { catchError, tap, throwError } from \"rxjs\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/router\";\nclass DataAccessService {\n  constructor(httpClient, router) {\n    this.httpClient = httpClient;\n    this.router = router;\n    this.apiEndpoint = \"http://localhost:8080/images\";\n    this.imagesById = {};\n    this.connectionError = \"Error occurred please try again later.\";\n    this.tooManyRequests = \"Too many requests! Please try again in a minute.\";\n  }\n  addImageById(image) {\n    this.imagesById[image.id] = image;\n  }\n  getImageById(id) {\n    let imageById = this.imagesById[id];\n    if (!imageById) {\n      this.router.navigate(['/']).catch(err => console.log(err));\n    }\n    return imageById;\n  }\n  categoriseImageUrl(url) {\n    const headers = new HttpHeaders({\n      \"Content-Type\": \"application/json\"\n    });\n    return this.httpClient.post(this.apiEndpoint, url, {\n      headers: headers\n    }).pipe(tap(data => this.addImageById(data)), catchError(this.handleError));\n  }\n  handleError(httpErrorResponse) {\n    let errorMessage = \"\";\n    if (httpErrorResponse.error instanceof ErrorEvent) {\n      errorMessage = this.connectionError;\n    } else {\n      if (httpErrorResponse.status === 429) {\n        errorMessage = this.tooManyRequests;\n      } else if (httpErrorResponse.status === 400 || httpErrorResponse.status === 503) {\n        errorMessage = httpErrorResponse.error.error;\n      }\n    }\n    console.error(errorMessage);\n    return throwError(() => errorMessage);\n  }\n}\nDataAccessService.ɵfac = function DataAccessService_Factory(t) {\n  return new (t || DataAccessService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.Router));\n};\nDataAccessService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: DataAccessService,\n  factory: DataAccessService.ɵfac,\n  providedIn: \"root\"\n});\nexport { DataAccessService };","map":{"version":3,"names":["HttpHeaders","catchError","tap","throwError","DataAccessService","constructor","httpClient","router","apiEndpoint","imagesById","connectionError","tooManyRequests","addImageById","image","id","getImageById","imageById","navigate","catch","err","console","log","categoriseImageUrl","url","headers","post","pipe","data","handleError","httpErrorResponse","errorMessage","error","ErrorEvent","status","i0","ɵɵinject","i1","HttpClient","i2","Router","factory","ɵfac","providedIn"],"sources":["/Users/georgicholev/MyDocuments/ics/ics-client/src/app/shared/data-access.service.ts"],"sourcesContent":["import {Injectable} from \"@angular/core\";\nimport {HttpClient, HttpErrorResponse, HttpHeaders} from \"@angular/common/http\";\nimport {UrlSubmit} from \"../url-submit/url-submit\";\nimport {catchError, Observable, tap, throwError} from \"rxjs\";\nimport {Image} from \"./image\";\nimport {ImageDetailComponent} from \"../image-detail/image-detail.component\";\nimport {Router} from \"@angular/router\";\n\n@Injectable({\n    providedIn: \"root\"\n})\nexport class DataAccessService {\n\n    private apiEndpoint = \"http://localhost:8080/images\";\n\n    constructor(private httpClient: HttpClient, private router: Router) {\n    }\n\n    imagesById: { [key: string]: Image } = {};\n\n    addImageById(image: Image) {\n        this.imagesById[image.id] = image;\n    }\n\n    getImageById(id:string) {\n        let imageById = this.imagesById[id];\n        if (!imageById) {\n            this.router.navigate(['/'])\n                .catch(err => console.log(err));\n        }\n        return imageById;\n    }\n\n    categoriseImageUrl(url: string): Observable<Image> {\n        const headers = new HttpHeaders({\"Content-Type\": \"application/json\"});\n        return this.httpClient\n            .post<Image>(this.apiEndpoint, url, {headers: headers})\n            .pipe(\n                tap(data => this.addImageById(data)),\n                catchError(this.handleError)\n            );\n    }\n\n    connectionError: string = \"Error occurred please try again later.\";\n    tooManyRequests: string = \"Too many requests! Please try again in a minute.\";\n\n    private handleError(httpErrorResponse: HttpErrorResponse) {\n        let errorMessage = \"\";\n        if (httpErrorResponse.error instanceof ErrorEvent) {\n            errorMessage = this.connectionError;\n        } else {\n            if (httpErrorResponse.status === 429) {\n                errorMessage = this.tooManyRequests;\n            } else if (httpErrorResponse.status === 400 || httpErrorResponse.status === 503) {\n                errorMessage = httpErrorResponse.error.error;\n            }\n        }\n\n        console.error(errorMessage);\n        return throwError(() => errorMessage);\n    }\n}\n"],"mappings":"AACA,SAAuCA,WAAW,QAAO,sBAAsB;AAE/E,SAAQC,UAAU,EAAcC,GAAG,EAAEC,UAAU,QAAO,MAAM;;;;AAK5D,MAGaC,iBAAiB;EAI1BC,YAAoBC,UAAsB,EAAUC,MAAc;IAA9C,KAAAD,UAAU,GAAVA,UAAU;IAAsB,KAAAC,MAAM,GAANA,MAAM;IAFlD,KAAAC,WAAW,GAAG,8BAA8B;IAKpD,KAAAC,UAAU,GAA6B,EAAE;IAyBzC,KAAAC,eAAe,GAAW,wCAAwC;IAClE,KAAAC,eAAe,GAAW,kDAAkD;EA5B5E;EAIAC,YAAYA,CAACC,KAAY;IACrB,IAAI,CAACJ,UAAU,CAACI,KAAK,CAACC,EAAE,CAAC,GAAGD,KAAK;EACrC;EAEAE,YAAYA,CAACD,EAAS;IAClB,IAAIE,SAAS,GAAG,IAAI,CAACP,UAAU,CAACK,EAAE,CAAC;IACnC,IAAI,CAACE,SAAS,EAAE;MACZ,IAAI,CAACT,MAAM,CAACU,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,CACtBC,KAAK,CAACC,GAAG,IAAIC,OAAO,CAACC,GAAG,CAACF,GAAG,CAAC,CAAC;;IAEvC,OAAOH,SAAS;EACpB;EAEAM,kBAAkBA,CAACC,GAAW;IAC1B,MAAMC,OAAO,GAAG,IAAIxB,WAAW,CAAC;MAAC,cAAc,EAAE;IAAkB,CAAC,CAAC;IACrE,OAAO,IAAI,CAACM,UAAU,CACjBmB,IAAI,CAAQ,IAAI,CAACjB,WAAW,EAAEe,GAAG,EAAE;MAACC,OAAO,EAAEA;IAAO,CAAC,CAAC,CACtDE,IAAI,CACDxB,GAAG,CAACyB,IAAI,IAAI,IAAI,CAACf,YAAY,CAACe,IAAI,CAAC,CAAC,EACpC1B,UAAU,CAAC,IAAI,CAAC2B,WAAW,CAAC,CAC/B;EACT;EAKQA,WAAWA,CAACC,iBAAoC;IACpD,IAAIC,YAAY,GAAG,EAAE;IACrB,IAAID,iBAAiB,CAACE,KAAK,YAAYC,UAAU,EAAE;MAC/CF,YAAY,GAAG,IAAI,CAACpB,eAAe;KACtC,MAAM;MACH,IAAImB,iBAAiB,CAACI,MAAM,KAAK,GAAG,EAAE;QAClCH,YAAY,GAAG,IAAI,CAACnB,eAAe;OACtC,MAAM,IAAIkB,iBAAiB,CAACI,MAAM,KAAK,GAAG,IAAIJ,iBAAiB,CAACI,MAAM,KAAK,GAAG,EAAE;QAC7EH,YAAY,GAAGD,iBAAiB,CAACE,KAAK,CAACA,KAAK;;;IAIpDX,OAAO,CAACW,KAAK,CAACD,YAAY,CAAC;IAC3B,OAAO3B,UAAU,CAAC,MAAM2B,YAAY,CAAC;EACzC;;AAjDS1B,iBAAiB,C;mBAAjBA,iBAAiB,EAAA8B,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,UAAA,GAAAH,EAAA,CAAAC,QAAA,CAAAG,EAAA,CAAAC,MAAA;AAAA;AAAjBnC,iBAAiB,C;SAAjBA,iBAAiB;EAAAoC,OAAA,EAAjBpC,iBAAiB,CAAAqC,IAAA;EAAAC,UAAA,EAFd;AAAM;SAETtC,iBAAiB"},"metadata":{},"sourceType":"module","externalDependencies":[]}